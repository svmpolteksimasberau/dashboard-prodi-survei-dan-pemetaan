<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luaran Dosen - PSBC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style> @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap'); body { font-family: 'Inter', sans-serif; } </style>
</head>
<body class="bg-slate-50 p-4 md:p-8">
    <div class="container mx-auto max-w-5xl">
        <a href="dashboard_dosen.html" class="text-blue-900 font-black text-xs uppercase italic mb-5 inline-block"><i class="fas fa-arrow-left"></i> Kembali</a>
        
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <form id="luaranForm" class="bg-white p-8 rounded-[3rem] shadow-xl border-t-8 border-green-600 space-y-4 h-fit">
                <h3 class="font-black text-blue-900 uppercase text-xs italic">Input Luaran</h3>
                <input type="text" id="judul" placeholder="Judul Luaran" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border-none text-sm font-bold" required>
                <select id="jenis" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border-none text-sm font-bold">
                    <option value="Publikasi Jurnal">Publikasi Jurnal</option>
                    <option value="HAKI">HAKI / Paten</option>
                    <option value="Buku Ber-ISBN">Buku Ber-ISBN</option>
                </select>
                <input type="url" id="link" placeholder="Link Bukti (URL)" class="w-full p-4 bg-gray-50 rounded-2xl outline-none border-none text-sm font-bold" required>
                <button type="submit" id="btnSub" class="w-full bg-green-600 text-white font-black py-4 rounded-2xl uppercase text-xs tracking-widest shadow-lg">Kirim Ke Cloud</button>
            </form>

            <div class="lg:col-span-2 bg-white rounded-[3rem] shadow-xl overflow-hidden border border-gray-100">
                <div class="p-6 bg-gray-50 border-b font-black text-blue-900 text-xs uppercase italic">Arsip Luaran Cloud</div>
                <div class="p-4 space-y-3" id="listLuaran">
                    </div>
            </div>
        </div>
    </div>

    <script>
        const scriptURL = 'https://script.google.com/macros/s/AKfycbye3Fg2t8LdKUhRPw66QVI8dyt-DjrjnQAVa585TTvN1Fde2BkFYCjkyTddPOZg-xZyGA/exec';
        const user = JSON.parse(localStorage.getItem('current_user'));

        async function loadLuaran() {
            const res = await fetch(scriptURL, {
                method: 'POST',
                body: JSON.stringify({ action: "readLuaran", type: "LUARAN", id: user.id })
            });
            const data = await res.json();
            const container = document.getElementById('listLuaran');
            container.innerHTML = "";
            data.forEach(item => {
                container.innerHTML += `
                    <div class="p-5 bg-slate-50 rounded-[2rem] flex justify-between items-center border border-gray-100">
                        <div>
                            <p class="text-[10px] font-black text-green-600 uppercase">${item.jenis}</p>
                            <p class="text-xs font-bold text-blue-900 uppercase">${item.judul}</p>
                            <a href="${item.link}" target="_blank" class="text-[9px] text-blue-400 underline italic">Lihat Link Bukti</a>
                        </div>
                        <button onclick="hapus('${item.rowId}')" class="text-red-400 p-3"><i class="fas fa-trash"></i></button>
                    </div>`;
            });
        }

        document.getElementById('luaranForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            document.getElementById('btnSub').innerText = "MENGIRIM...";
            const payload = {
                action: "INSERT", type: "LUARAN", id: user.id, nama: user.name,
                judul: document.getElementById('judul').value,
                jenis: document.getElementById('jenis').value,
                link: document.getElementById('link').value,
                rowId: "LUA-" + Date.now()
            };
            await fetch(scriptURL, { method: 'POST', body: JSON.stringify(payload) });
            location.reload();
        });

        async function hapus(id) {
            if(confirm("Hapus dari cloud?")) {
                await fetch(scriptURL, { method: 'POST', body: JSON.stringify({ action: "DELETE", type: "LUARAN", rowId: id }) });
                loadLuaran();
            }
        }
        window.onload = loadLuaran;
    </script>
</body>
</html>
