<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Poltek Simas BC</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-gray-50 font-sans">

    <nav class="bg-blue-900 text-white p-4 shadow-xl">
        <div class="container mx-auto flex justify-between items-center">
            <div class="flex items-center gap-3">
                <i class="fas fa-map-marked-alt text-yellow-400"></i>
                <h1 class="text-xs font-black uppercase">Survei dan Pemetaan - PSBC</h1>
            </div>
            <button onclick="logout()" class="bg-red-600 p-2 rounded-lg text-xs font-bold">LOGOUT</button>
        </div>
    </nav>

    <div class="container mx-auto py-10 px-6">
        <div class="mb-10">
            <p id="roleLabel" class="text-[10px] font-black text-orange-600 uppercase tracking-widest mb-1">Role</p>
            <h2 class="text-3xl font-black text-blue-900 uppercase leading-none">
                Halo, <span id="userName" class="text-orange-600">User</span>!
            </h2>
        </div>

        <div id="summaryDosen" class="hidden grid grid-cols-2 lg:grid-cols-4 gap-4 mb-10 text-white">
            <div class="bg-blue-900 p-5 rounded-3xl shadow-lg">
                <p class="text-[8px] uppercase font-bold opacity-70">Mahasiswa Aktif</p>
                <p id="realTotalMhs" class="text-2xl font-black">0</p>
            </div>
            <div class="bg-orange-600 p-5 rounded-3xl shadow-lg">
                <p class="text-[8px] uppercase font-bold opacity-70">Logbook Pending</p>
                <p id="realLogbookPending" class="text-2xl font-black">0</p>
            </div>
        </div>

        <div id="menuContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div id="cardLogMhs" class="hidden bg-white p-8 rounded-[2rem] shadow-lg border-b-8 border-blue-900">
                <h3 class="font-black text-blue-900 uppercase">Input Logbook</h3>
                <p class="text-xs text-gray-500 my-4">Catat aktivitas harian prakerin/magang Anda di sini.</p>
                <a href="logbook.html" class="inline-block bg-blue-900 text-white px-6 py-3 rounded-xl font-black text-[10px] uppercase">Buka Logbook</a>
            </div>

            <div id="cardMonitor" class="hidden bg-white p-8 rounded-[2rem] shadow-lg border-b-8 border-orange-600">
                <h3 class="font-black text-blue-900 uppercase">Monitoring Mahasiswa</h3>
                <p class="text-xs text-gray-500 my-4">Pantau aktivitas dan berikan penilaian logbook mahasiswa.</p>
                <a href="penilaian_logbook.html" class="inline-block bg-orange-600 text-white px-6 py-3 rounded-xl font-black text-[10px] uppercase">Buka Penilaian</a>
            </div>
        </div>
    </div>

    <script>
        // 1. Ambil data user
        const userData = localStorage.getItem('current_user');
        const user = userData ? JSON.parse(userData) : null;

        // 2. Cek apakah ada data login
        if (!user) {
            window.location.href = 'index.html';
        } else {
            // Pasang Nama & Role
            document.getElementById('userName').innerText = user.name || "User";
            document.getElementById('roleLabel').innerText = user.role || "Role";

            // Tampilkan Menu Berdasarkan Role
            if (user.role === 'dosen') {
                document.getElementById('summaryDosen').classList.remove('hidden');
                document.getElementById('cardMonitor').classList.remove('hidden');
                updateStats();
            } else {
                document.getElementById('cardLogMhs').classList.remove('hidden');
            }
        }

        // 3. Update Statistik Dosen
        function updateStats() {
            let totalMhs = 0;
            let pending = 0;
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('user_db_')) {
                    const data = JSON.parse(localStorage.getItem(key));
                    if (data.role === 'mahasiswa') {
                        totalMhs++;
                        const logs = localStorage.getItem('log_' + data.id);
                        if (!logs || JSON.parse(logs).length === 0) pending++;
                    }
                }
            }
            document.getElementById('realTotalMhs').innerText = totalMhs;
            document.getElementById('realLogbookPending').innerText = pending;
        }

        function logout() {
            localStorage.removeItem('current_user');
            window.location.href = 'index.html';
        }
    </script>
</body>
</html>
